<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kuiz Bijak Sifir</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
<style>
    /* Muatkan font 'Inter' */
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
    body { font-family: 'Inter', sans-serif; transition: background-color 0.3s, color 0.3s; }
    
    /* Gaya Dark Mode */
    .dark-mode { background-color: #1a202c; color: #f7fafc; }
    .dark-mode #quiz-container-wrapper { background-color: #2d3748; border-color: #f472b6; color: white; }
    .dark-mode label { color: #e2e8f0 !important; }
    .dark-mode .bg-gray-100 { background-color: #4a5568; }
    .dark-mode .bg-teal-50 { background-color: #283637; }
    .dark-mode .text-gray-600, .dark-mode .text-gray-700 { color: #cbd5e0 !important; }
    
    /* FIX: Pastikan teks input (nama pelajar) kekal hitam dalam mod gelap supaya nampak jelas */
    .dark-mode input { color: #1a202c !important; }

    /* Gaya Font Standard untuk Jenama */
    .brand-marykate {
        font-family: 'Inter', sans-serif; 
        color: #ec4899; 
        font-size: 0.875rem; 
        line-height: 1.5rem;
        font-weight: 900; 
        text-transform: uppercase;
        letter-spacing: 0.05em;
    }

    .result-score {
        animation: pulse-score 1.5s infinite;
    }
    @keyframes pulse-score {
        0 { transform: scale(1); }
        50% { transform: scale(1.05); box-shadow: 0 0 20px rgba(236, 72, 153, 0.7); }
        100% { transform: scale(1); }
    }
    .urgent-timer {
        color: #fff; 
        background-color: #ef4444; 
        border-color: #fca5a5; 
        animation: urgent-pulse 0.5s infinite;
    }
    @keyframes urgent-pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.7; }
    }

    #certificate-screen {
        overflow-y: auto; 
    }

    .tp-hidden {
         display: none;
    }

    @media print {
        @page {
            size: A4 portrait; 
            margin: 0.5cm;     
        }

        body {
            margin: 0;
            padding: 0;
            background-color: white !important;
            display: block; 
        }
        
        #quiz-container-wrapper, #cert-controls {
            display: none !important;
        }
        
        #certificate-screen {
            position: static !important;
            display: block !important;
            margin: auto;
            padding: 0; 
            max-width: none; 
            max-height: none; 
            overflow: hidden; 
        }
        
        #certificate-content {
            box-shadow: none !important;
            border: none !important;
            min-height: 28.7cm; 
            width: 20.0cm;      
            padding: 1.0cm 1cm !important; 
            font-size: 0.85em; 
        }
        
        #certificate-content .mx-auto.w-48 { width: 3.5cm !important; } 
        #certificate-content .text-5xl { font-size: 2rem !important; } 
        #certificate-content .text-6xl { font-size: 3rem !important; } 
        #certificate-content .text-4xl { font-size: 1.75rem !important; } 
        #certificate-content .text-2xl { font-size: 1.1rem !important; } 
        #certificate-content .text-lg { font-size: 0.8rem !important; } 
        #certificate-content .text-sm { font-size: 0.75rem !important; } 
        
        #certificate-content .pt-4 { padding-top: 0.4rem !important; } 
        #certificate-content .my-4 { margin-top: 0.4rem !important; margin-bottom: 0.4rem !important; } 
        #certificate-content .py-2 { padding-top: 0.2rem !important; padding-bottom: 0.2rem !important; } 
        #certificate-content .mt-2 { margin-top: 0.4rem !important; }

        .flex-col .space-y-3 { margin-top: 0.6rem !important; } 
        #certificate-content .mt-6 { margin-top: 1rem !important; } 

        #certificate-content .mt-4 { margin-top: 0.5rem !important; margin-bottom: 0.5rem !important; } 
        #certificate-content .w-48.h-auto { width: 3cm !important; } 
        #certificate-content .text-lg.font-bold { margin-top: -0.2rem !important; } 
        #certificate-content .text-sm.font-semibold { margin-top: 0.1rem !important; } 

        .print\:hidden {
            display: none !important;
        }
    }
    </style>
</head>
<body class="bg-yellow-50 min-h-screen flex items-center justify-center p-4">
	<div id="quiz-container-wrapper" class="w-full max-w-md bg-white p-6 rounded-xl shadow-xl border-3 border-pink-300">
		
		<div class="flex flex-col items-center justify-center mb-5">
            <img src="https://raw.githubusercontent.com/mizz85/nota-sifir/main/logo-mizzz.png" alt="Logo Edukids by Mizz" class="w-40 h-auto mb-2">
            <h1 class="text-2xl font-extrabold text-teal-600 text-center">
                Kuiz Bijak Sifir
            </h1>
            </div>

        <div id="quiz-container">
            
            <div id="login-screen" class="space-y-4">
                <p class="text-gray-600 text-center text-sm font-semibold">
                    Akses terhad. Sila masukkan Kata Laluan untuk meneruskan.
                </p>

                <div class="space-y-2">
                    <label for="password-input" class="block text-sm font-medium text-gray-700">Kata Laluan:</label>
                    <input type="text" id="password-input" placeholder="Masukkan Kata Laluan" class="w-full p-3 text-center text-lg font-bold border-3 border-pink-400 rounded-lg focus:border-teal-500 focus:ring-4 focus:ring-teal-200" onkeydown="handleLoginKey(event)" autofocus>
                    <p id="login-feedback" class="h-6 text-sm font-semibold text-red-600 text-center"></p>
                </div>

                <button onclick="checkPassword()" id="login-button" class="w-full bg-pink-500 hover:bg-pink-600 text-white font-black text-base py-3 rounded-lg transition duration-150 shadow-lg hover:shadow-xl">
                    Log Masuk
                </button>
               <p class="text-xs text-gray-500 text-center mt-3">
    Lupa atau Tiada Kata Laluan?
    <a href="https://wa.me/60198950339?text=Assalamualaikum/Hai.%20Saya%20memohon%20kata%20laluan%20untuk%20Kuiz%20Bijak%20Sifir.%20Nama%20saya%20[Nama%20Pelajar/Ibu%20Bapa]." target="_blank" class="font-bold text-pink-500 hover:text-pink-600 transition duration-150">
        Minta Kata Laluan (KLIK SINI üëà).
    </a>
</p>
            </div>
            
            <div id="selection-screen" class="hidden space-y-4">
                
                <div class="flex items-center justify-between p-3 bg-indigo-100 rounded-lg border border-indigo-300">
                    <label class="text-sm font-black text-indigo-900">
                        üåô Mod Malam / Cerah ‚òÄÔ∏è
                    </label>
                    <button onclick="toggleDarkMode()" class="px-4 py-1 bg-indigo-600 text-white rounded-md text-xs font-bold shadow-md">Tukar</button>
                </div>

                <div class="space-y-2 p-3 bg-teal-50 rounded-lg border border-teal-300">
                    <label for="student-name-input" class="block text-sm font-black text-teal-700">
                        Nama Pelajar:
                    </label>
                    <input 
                        type="text" 
                        id="student-name-input" 
                        placeholder="Cth: Izzara Binti Shamsul" 
                        class="w-full p-3 text-center text-base font-bold border-2 border-teal-500 rounded-lg focus:border-pink-500 focus:ring-2 focus:ring-pink-200" 
                        oninput="updateAndSaveName(event)"
                    >
                    <p id="current-name-display" class="text-xs text-gray-600 italic mt-1 text-center"></p>
                </div>

                <div class="flex items-center justify-between p-3 bg-gray-100 rounded-lg border border-gray-300">
                    <label for="timer-toggle" class="text-sm font-black text-gray-700">
                        ‚è±Ô∏è Pemasa Soalan (Hidup/Mati)
                    </label>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" id="timer-toggle" class="sr-only peer" checked>
                        <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-pink-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-pink-500"></div>
                    </label>
                </div>
                <div class="flex items-center justify-between p-3 bg-gray-100 rounded-lg border border-gray-300">
                    <label for="tone-toggle" class="text-sm font-black text-gray-700">
                        üîî Audio Bunyi (Nada Betul/Salah & Bip Amaran)
                    </label>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" id="tone-toggle" class="sr-only peer" checked>
                        <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-pink-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-pink-500"></div>
                    </label>
                </div>
                
                <div class="flex items-center justify-between p-3 bg-gray-100 rounded-lg border border-gray-300">
                    <label for="tts-toggle" class="text-sm font-black text-gray-700">
                        üó£Ô∏è Suara (Teks-ke-Ucapan / TTS)
                    </label>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" id="tts-toggle" class="sr-only peer" checked>
                        <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-pink-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-pink-500"></div>
                    </label>
                </div>
                <div class="mt-2">
                    <button 
                        onclick="toggleNote('tts-note-content')" 
                        class="w-full text-xs font-extrabold text-red-700 p-2 text-center bg-red-100 hover:bg-red-200 rounded-lg border border-red-300 flex items-center justify-center transition duration-150">
                        ‚ö†Ô∏è Nota Suara üó£Ô∏è (Klik untuk baca)
                        <span id="tts-arrow" class="ml-2">‚ñº</span>
                    </button>
                    <div id="tts-note-content" class="text-xs italic text-red-700 p-2 text-left bg-red-50 rounded-lg border-x border-b border-red-300 hidden -mt-2">
                        Kualiti fungsi suara bergantung pada pelayar (Chrome, dsb.) dan peranti yang digunakan. Jika suara TTS tidak seperti penutur Melayu yang fasih, anda disyorkan untuk **MATIKAN SUARA** (Off) bagi mengelakkan gangguan konsentrasi atau fokus.
                    </div>
                </div>
                <div class="mt-2">
                    <button 
                        onclick="toggleNote('cert-note-content')" 
                        class="w-full text-xs font-extrabold text-blue-700 p-2 text-center bg-blue-100 hover:bg-blue-200 rounded-lg border border-blue-300 flex items-center justify-center transition duration-150">
                        üìÑ Nota Cetak Sijil (Klik untuk baca)
                        <span id="cert-arrow" class="ml-2">‚ñº</span>
                    </button>
                    <div id="cert-note-content" class="text-xs italic text-blue-700 p-2 text-left bg-blue-50 rounded-lg border-x border-b border-red-300 hidden -mt-2">
                        Untuk memastikan fungsi 'Cetak/Simpan PDF Sijil' berjaya, sila buka pautan kuiz ini **secara langsung** di Pelayar Penuh (Chrome/Safari) dan **BUKAN** Pelayar Dalaman (In-App Browser) seperti dalam WhatsApp atau Facebook.
                    </div>
                </div>
                <p class="text-gray-600 text-center text-sm">
                    Sila pilih jenis kuiz dan sifir yang ingin diuji.
                </p>

                <div class="space-y-2">
                    <label for="sifir-pilihan" class="block text-sm font-medium text-gray-700">Pilih Jenis Ujian:</label>
                    <select id="sifir-pilihan" class="w-full p-3 border-2 border-pink-400 rounded-lg shadow-md focus:ring-teal-500 focus:border-teal-500 bg-white text-teal-700 font-semibold text-sm">
                        <option value="0-objective-50">üéØ Semua Sifir (1-12) - Objektif A/B/C/D (50 Soalan)</option>
                        <option value="0-input-50">‚úçÔ∏è Semua Sifir (1-12) - Input Jawapan (50 Soalan)</option>
                        
                        <option disabled>--- Sifir Tunggal (30 Soalan) ---</option>
                        <option value="2-objective-30">üéØ Sifir 2 - Objektif (30 Soalan, 7s)</option>
                        <option value="3-objective-30">üéØ Sifir 3 - Objektif (30 Soalan, 7s)</option>
                        <option value="4-objective-30">üéØ Sifir 4 - Objektif (30 Soalan, 7s)</option>
                        <option value="5-objective-30">üéØ Sifir 5 - Objektif (30 Soalan, 7s)</option>
                        <option value="6-objective-30">üéØ Sifir 6 - Objektif (30 Soalan, 7s)</option>
                        <option value="7-objective-30">üéØ Sifir 7 - Objektif (30 Soalan, 7s)</option>
                        <option value="8-objective-30">üéØ Sifir 8 - Objektif (30 Soalan, 7s)</option>
                        <option value="9-objective-30">üéØ Sifir 9 - Objektif (30 Soalan, 7s)</option>
                        <option value="10-objective-30">üéØ Sifir 10 - Objektif (30 Soalan, 7s)</option>
                        <option value="11-objective-30">üéØ Sifir 11 - Objektif (30 Soalan, 7s)</option>
                        <option value="12-objective-30">üéØ Sifir 12 - Objektif (30 Soalan, 7s)</option>
                        
                        <option value="2-input-30">‚úçÔ∏è Sifir 2 (30 Soalan, 10s)</option>
                        <option value="3-input-30">‚úçÔ∏è Sifir 3 (30 Soalan, 10s)</option>
                        <option value="4-input-30">‚úçÔ∏è Sifir 4 (30 Soalan, 10s)</option>
                        <option value="5-input-30">‚úçÔ∏è Sifir 5 (30 Soalan, 10s)</option>
                        <option value="6-input-30">‚úçÔ∏è Sifir 6 (30 Soalan, 10s)</option>
                        <option value="7-input-30">‚úçÔ∏è Sifir 7 (30 Soalan, 10s)</option>
                        <option value="8-input-30">‚úçÔ∏è Sifir 8 (30 Soalan, 10s)</option>
                        <option value="9-input-30">‚úçÔ∏è Sifir 9 (30 Soalan, 10s)</option>
                        <option value="10-input-30">‚úçÔ∏è Sifir 10 (30 Soalan, 10s)</option>
                        <option value="11-input-30">‚úçÔ∏è Sifir 11 (30 Soalan, 10s)</option>
                        <option value="12-input-30">‚úçÔ∏è Sifir 12 (30 Soalan, 10s)</option>
                    </select>
                </div>
                
                <div class="mt-4 p-4 bg-purple-100 rounded-lg border-2 border-purple-500 shadow-md transition duration-300 hover:bg-purple-200">
                    <p class="text-sm font-extrabold text-purple-800 mb-1 text-center">
                        üìö Ulangkaji Sifir & Bantuan Mengajar?
                    </p>
                    <a href="https://mizz-ana.my.canva.site/bahan-bantu-mengajar" target="_blank" class="w-full block bg-purple-600 hover:bg-purple-700 text-white font-black text-center text-sm py-2 rounded-lg transition duration-150 shadow-lg">
                        Klik Sini untuk Dapatkan BBM Digital Mizz!
                    </a>
                </div>
                <button onclick="startQuizFlow()" id="start-button" class="w-full bg-pink-500 hover:bg-pink-600 text-white font-black text-base py-3 rounded-lg transition duration-150 shadow-lg hover:shadow-xl">
                    Mulakan Kuiz
                </button>
            </div>

            <div id="quiz-screen" class="hidden text-center space-y-4">
                
                <div class="w-full flex justify-between items-center mb-3">
                    <div class="w-3/4 bg-gray-200 rounded-full h-3">
                        <div id="progress-bar" class="bg-pink-500 h-3 rounded-full transition-all duration-300 ease-out" style="width: 0%"></div>
                    </div>
                    <div id="q-countdown-display" class="text-lg font-black text-teal-600 border-2 border-teal-300 px-3 py-0.5 rounded-full shadow-md transition-colors duration-300">
                        7s
                    </div>
                </div>

                <p class="text-xs text-gray-500">
                    Soalan <span id="current-q-num">1</span> dari <span id="total-q-display">50</span>
                </p>
                <span id="total-time-tracker" class="hidden">0</span>

                <div class="bg-yellow-200 p-6 rounded-xl shadow-lg border-2 border-yellow-500">
                    <p class="text-lg text-gray-500 mb-1">Berapakah</p>
                    <p id="question-text" class="text-4xl font-extrabold text-teal-800">
                        7 x 8 ?
                    </p>
                </div>

                <div id="input-mode" class="space-y-3">
                    <input type="number" id="answer-input" placeholder="Jawab di sini" class="w-full p-3 text-center text-2xl font-bold border-3 border-pink-400 rounded-lg focus:border-teal-500 focus:ring-4 focus:ring-teal-200" onkeydown="handleInputKey(event)" autofocus>

                    <button onclick="handleInputSubmission()" class="w-full bg-lime-500 hover:bg-lime-600 text-white font-black text-base py-3 rounded-lg transition duration-150 shadow-lg hover:shadow-xl">
                        Hantar Jawapan
                    </button>
                </div>

                <div id="objective-mode" class="hidden grid grid-cols-2 gap-3">
                    <button id="option-A" onclick="handleObjectiveSubmission(this)" data-value="" class="objective-btn p-3 text-xl font-bold text-white bg-teal-500 rounded-lg hover:bg-teal-600 transition duration-150 shadow-md">
                        A. <span></span>
                    </button>
                    <button id="option-B" onclick="handleObjectiveSubmission(this)" data-value="" class="objective-btn p-3 text-xl font-bold text-white bg-teal-500 rounded-lg hover:bg-teal-600 transition duration-150 shadow-md">
                        B. <span></span>
                    </button>
                    <button id="option-C" onclick="handleObjectiveSubmission(this)" data-value="" class="objective-btn p-3 text-xl font-bold text-white bg-teal-500 rounded-lg hover:bg-teal-600 transition duration-150 shadow-md">
                        C. <span></span>
                    </button>
                    <button id="option-D" onclick="handleObjectiveSubmission(this)" data-value="" class="objective-btn p-3 text-xl font-bold text-white bg-teal-500 rounded-lg hover:bg-teal-600 transition duration-150 shadow-md">
                        D. <span></span>
                    </button>
                </div>


                <div id="feedback" class="h-6 text-sm font-semibold"></div>

                <button onclick="returnToSelection()" class="w-full bg-gray-200 text-black hover:bg-gray-300 font-extrabold text-sm py-2 rounded-lg transition duration-150 shadow-sm mt-4">
                    Kembali ke Pilihan Sifir
                </button>
            </div>

            <div id="result-screen" class="hidden text-center space-y-4">
                
                <div id="quiz-result-title" class="mb-3">
                    <h2 class="text-xl font-bold text-teal-700 leading-tight">Keputusan Kuiz Anda</h2>
                    <p id="sifir-title-display" class="text-2xl font-extrabold text-pink-600 leading-tight">Sifir</p>
                </div>

                <div id="student-result-name" class="text-xl font-extrabold text-pink-600 mb-3 -mt-2">
                    [Nama Pelajar Akan Dipaparkan Di Sini]
                </div>
                
                <p id="main-tp-message" class="text-base font-semibold text-gray-700"></p>

                <div id="tp-display-group">
                    <div class="p-4 bg-yellow-100 rounded-xl border-3 border-yellow-500">
                        <p class="text-base font-semibold text-gray-700">Tahap Penguasaan (TP) Dicapai:</p>
                        <p id="final-tp" class="text-6xl font-black text-pink-600 result-score mt-1">TPX</p>
                        <p id="tp-label" class="text-xl font-extrabold text-teal-600 mt-1">Label TP</p>
                    </div>

                    <div class="p-3 bg-pink-100 rounded-lg border border-pink-400 text-left">
                        <p class="text-sm font-bold text-pink-700 mb-1">Penerangan Tahap:</p>
                        <p id="tp-description" class="text-sm text-gray-800 italic">
                            [Penerangan terperinci mengikut DSKP akan dipaparkan di sini.]
                        </p>
                    </div>
                </div>
                <div class="text-left space-y-2 text-sm text-gray-700">
                    <p>‚≠ê Skor Anda: <span id="final-score" class="font-bold text-teal-600"></span></p>
                    <p>üìä Peratusan: <span id="final-percentage" class="font-bold text-teal-600"></span></p>
                    <p>‚úÖ Jawapan Betul: <span id="correct-count" class="font-bold text-lime-600"></span></p>
                    <p>‚ùå Jawapan Salah: <span id="incorrect-count" class="font-bold text-red-600"></span></p>
                    <p>‚è±Ô∏è Purata Masa Tindak Balas: <span id="average-time" class="font-bold"></span> saat</p>
                    <p id="timer-status-message" class="text-xs italic text-gray-500"></p>
                </div>
                
                <button onclick="startNewQuizSelection()" class="w-full bg-pink-500 hover:bg-pink-600 text-white font-black text-base py-3 rounded-lg transition duration-150 shadow-lg hover:shadow-xl mt-3">
                    Ulang Kuiz (Pilihan Sifir)
                </button>
            </div>
        </div>
    </div>
    
    <div id="certificate-screen" class="hidden fixed inset-0 z-50 bg-white items-center justify-center p-4 overflow-y-auto">
        
        <div id="certificate-content" class="w-full max-w-4xl p-8 md:p-12 bg-white shadow-2xl border-4 border-pink-500 rounded-xl relative">
            <div class="text-center space-y-4">
                
                <img src="https://raw.githubusercontent.com/mizz85/nota-sifir/main/logo-mizzz.png" alt="Logo Edukids by Mizz" class="mx-auto w-48 h-auto mb-2"/>
                <h1 class="text-4xl md:text-5xl font-black text-teal-700">SIJIL PENGHARGAAN</h1>
                
                <p class="text-lg text-gray-700 pt-4">Dengan sukacitanya diperakui bahawa</p>
                
                <p id="cert-student-name" class="text-3xl md:text-6xl font-extrabold text-pink-600 my-4 py-2 border-b-4 border-pink-200 inline-block px-8">
                    [NAMA PELAJAR]
                </p>

                <p class="text-lg text-gray-700">Telah berjaya menyelesaikan</p>
                
                <h2 id="cert-quiz-title" class="text-2xl md:text-3xl font-bold text-teal-600 mt-2">
                    Kuiz Bijak Sifir Gabungan (1-12)
                </h2>
                
                <div class="flex flex-col md:flex-row justify-center space-y-3 md:space-y-0 md:space-x-8 mt-6 text-left">
                    <div class="bg-yellow-50 p-4 rounded-lg border border-yellow-300">
                        <p class="text-base font-semibold text-gray-700">Tahap Penguasaan (TP):</p>
                        <p id="cert-tp" class="text-5xl font-black text-pink-600 mt-1">TPX</p>
                    </div>
                    <div class="bg-lime-50 p-4 rounded-lg border border-lime-300">
                        <p class="text-base font-semibold text-gray-700">Pencapaian Skor:</p>
                        <p id="cert-score" class="text-5xl font-black text-lime-600 mt-1">100%</p>
                    </div>
                    <div class="bg-teal-50 p-4 rounded-lg border border-teal-300">
                        <p class="text-base font-semibold text-gray-700">Purata Masa (s):</p>
                        <p id="cert-avg-time" class="text-5xl font-black text-teal-600 mt-1">0.00s</p>
                    </div>
                </div>

                <p class="text-sm italic text-gray-500 pt-4">
                    Dikeluarkan pada <span id="cert-date">1 Januari 2024</span>
                </p>
                
                <p id="cert-timer-note" class="text-sm font-extrabold text-red-700 mt-1 italic"></p>
                <div class="flex flex-col items-center mt-4"> 
                    <img src="https://raw.githubusercontent.com/mizz85/kuiz-bijak-sifir/main/MizzSignature.png" alt="Tandatangan Mizz" class="w-48 h-auto"> 
                    <p class="text-lg font-bold text-gray-800 -mt-1">Mizz</p>
                    <p class="text-sm font-semibold text-teal-600">Ketua Projek Pembangunan Bijak Sifir</p>
                </div>
                </div>
        </div>
        <div id="cert-controls" class="w-full max-w-4xl p-4 mt-4 print:hidden flex flex-col space-y-2">
            <button onclick="window.print()" class="w-full bg-teal-500 hover:bg-teal-600 text-white font-black text-base py-3 rounded-lg transition duration-150 shadow-lg hover:shadow-xl">
                üñ®Ô∏è Cetak / Simpan PDF Sijil
            </button>
            <button onclick="closeCertificate()" class="w-full bg-gray-200 text-gray-700 hover:bg-gray-300 font-semibold text-sm py-2 rounded-lg transition duration-150 shadow-sm">
                Kembali ke Keputusan
            </button>
        </div>
        </div>

    <script>
        // Global State Variables
        const QUIZ_DURATION = 999999; 
        const CORRECT_PASSWORD = '2x5=10';
        
        let audioContext = null;
        let currentSifir = 0;
        let currentMode = 'input'; 
        let totalQuestions = 50; 
        let isCombinedQuiz = true; 
        let questionDuration = 7; 

        let isTimerEnabled = true; 
        let isToneEnabled = true;  
        let isTTSEnabled = true;   

        let questions = [];
        let currentQIndex = 0;
        let score = 0;
        let totalTimeElapsed = 0; 
        
        let totalTimeInterval = null; 
        let qTimerInterval = null;    
        let qTimeLeft = 7; 
        let warningBeepInterval = null; 
        
        let studentName = '';
        const STORAGE_KEY_NAME = 'student_name_sifir'; 
        const STORAGE_KEY_TIMER = 'is_timer_enabled'; 
        const STORAGE_KEY_TONE = 'is_tone_enabled';
        const STORAGE_KEY_TTS = 'is_tts_enabled';

        const correctAnswersPhrases = ["Awak Hebat!", "Tahniah, Terbaik!", "Awak Bijak!", "Betul, Hebat!"];
        let phraseIndex = 0;

        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            const isDark = document.body.classList.contains('dark-mode');
            localStorage.setItem('dark_mode_enabled', isDark);
        }

        function toggleNote(contentId) {
            const content = document.getElementById(contentId);
            const arrowId = contentId.includes('tts') ? 'tts-arrow' : 'cert-arrow';
            const arrow = document.getElementById(arrowId);

            if (content.classList.contains('hidden')) {
                content.classList.remove('hidden');
                arrow.textContent = '‚ñ≤';
            } else {
                content.classList.add('hidden');
                arrow.textContent = '‚ñº';
            }
        }

        function loadSettingsLocally() {
            const storedName = localStorage.getItem(STORAGE_KEY_NAME);
            if (storedName) {
                studentName = storedName;
                document.getElementById('student-name-input').value = studentName;
                document.getElementById('current-name-display').textContent = `Nama yang disimpan: ${studentName}`;
            } else {
                 document.getElementById('current-name-display').textContent = `Nama belum disimpan.`;
            }

            if (localStorage.getItem('dark_mode_enabled') === 'true') {
                document.body.classList.add('dark-mode');
            }
            
            const storedTimer = localStorage.getItem(STORAGE_KEY_TIMER);
            if (storedTimer !== null) {
                isTimerEnabled = storedTimer === 'true';
            }
            document.getElementById('timer-toggle').checked = isTimerEnabled; 

            const storedTone = localStorage.getItem(STORAGE_KEY_TONE);
            if (storedTone !== null) {
                isToneEnabled = storedTone === 'true';
            }
            document.getElementById('tone-toggle').checked = isToneEnabled;

            const storedTTS = localStorage.getItem(STORAGE_KEY_TTS);
            if (storedTTS !== null) {
                isTTSEnabled = storedTTS === 'true';
            }
            document.getElementById('tts-toggle').checked = isTTSEnabled;

            if (!isTTSEnabled) {
                window.speechSynthesis.cancel();
            }
        }

        function updateAndSaveName(event) {
            const name = event.target.value.trim();
            studentName = name;
            localStorage.setItem(STORAGE_KEY_NAME, name);
            
            if (name) {
                document.getElementById('current-name-display').textContent = `Nama yang disimpan: ${name}`;
            } else {
                 document.getElementById('current-name-display').textContent = `Nama belum disimpan.`;
            }
        }
        
        loadSettingsLocally(); 
        
        document.addEventListener('DOMContentLoaded', () => {
            const toneToggle = document.getElementById('tone-toggle');
            const ttsToggle = document.getElementById('tts-toggle');
            const timerToggle = document.getElementById('timer-toggle'); 

            if (timerToggle) {
                 timerToggle.addEventListener('change', (event) => {
                    isTimerEnabled = event.target.checked;
                    localStorage.setItem(STORAGE_KEY_TIMER, isTimerEnabled);
                });
            }

            if (toneToggle) {
                toneToggle.addEventListener('change', (event) => {
                    isToneEnabled = event.target.checked;
                    localStorage.setItem(STORAGE_KEY_TONE, isToneEnabled);
                    if (!isToneEnabled) {
                        stopWarningBeeps(); 
                    }
                });
            }

            if (ttsToggle) {
                ttsToggle.addEventListener('change', (event) => {
                    isTTSEnabled = event.target.checked;
                    localStorage.setItem(STORAGE_KEY_TTS, isTTSEnabled);
                    if (!isTTSEnabled) {
                        window.speechSynthesis.cancel(); 
                    }
                });
            }
        });

        function showScreen(screenId) {
            const screens = ['login-screen', 'selection-screen', 'quiz-screen', 'result-screen'];
            screens.forEach(id => {
                document.getElementById(id).classList.add('hidden');
            });
            document.getElementById(screenId).classList.remove('hidden');
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                const temp = array[i];
                array[i] = array[j];
                array[j] = temp;
            }
        }

        function speakMalay(textToRead) {
            if (!isTTSEnabled) return; 
            
            if (!('speechSynthesis' in window)) {
                return;
            }
            
            // window.speechSynthesis.cancel(); // Dibuang untuk elak cancel soalan pertama

            try {
                const utterance = new SpeechSynthesisUtterance(textToRead);
                utterance.lang = 'ms-MY';
                utterance.rate = 1.0;

                const voices = window.speechSynthesis.getVoices();
                let malayVoice = voices.find(voice => 
                    voice.lang === 'ms-MY' || 
                    voice.name.toLowerCase().includes('malay') || 
                    voice.name.toLowerCase().includes('melayu')
                );

                if (malayVoice) {
                    utterance.voice = malayVoice;
                }

                window.speechSynthesis.speak(utterance);
            } catch (error) {
                console.error("Ralat TTS", error);
            }
        }

        function initAudio() {
            if (!audioContext) {
                try {
                    audioContext = new (window.AudioContext || window.webkitAudioContext)();
                } catch (e) {
                    console.error("Web Audio API ralat", e);
                }
            }
        }

        document.getElementById('login-button').addEventListener('click', initAudio, { once: true });
        document.getElementById('password-input').addEventListener('keydown', (event) => {
            if (event.key === 'Enter') initAudio();
        }, { once: true });

        function playTone(frequency, duration, type = 'sine') {
            initAudio();
            if (!audioContext || !isToneEnabled) return; 

            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();

            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);

            oscillator.type = type;
            gainNode.gain.setValueAtTime(0.5, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + duration);

            oscillator.frequency.setValueAtTime(frequency, audioContext.currentTime);

            oscillator.start();
            oscillator.stop(audioContext.currentTime + duration);
        }

        function playCorrectSound() {
            playTone(880, 0.15, 'sine');
        }

        function playIncorrectSound() {
            playTone(220, 0.3, 'triangle');
        }

        function playWarningBeep() {
            playTone(800, 0.1, 'square');
        }

        function startWarningBeeps() {
            if (!isToneEnabled) return; 
            if (warningBeepInterval) return;
            
            warningBeepInterval = setInterval(() => {
                if (isTimerEnabled && qTimeLeft <= 3 && qTimeLeft > 0) {
                    playWarningBeep();
                }
            }, 500);
        }

        function stopWarningBeeps() {
            if (warningBeepInterval) {
                clearInterval(warningBeepInterval);
                warningBeepInterval = null;
            }
        }

        function isMobileInAppBrowser() {
            const ua = navigator.userAgent || navigator.vendor || window.opera;
            const isInApp = /FB_IAB|FBAV|Instagram|Line|KAKAOTALK|CriOS|WebView|wv/i.test(ua);
            const isMajorBrowser = /Chrome|Safari|Firefox|Edg/i.test(ua) && !/wv/i.test(ua);
            return isInApp || (!isMajorBrowser && /Mobile/i.test(ua));
        }

        function checkPassword() {
            const input = document.getElementById('password-input').value.trim();
            const feedback = document.getElementById('login-feedback');
            
            if (input === CORRECT_PASSWORD) {
                feedback.textContent = 'Log Masuk Berjaya!';
                feedback.classList.remove('text-red-600');
                feedback.classList.add('text-lime-600');
                
                showScreen('selection-screen');
                loadSettingsLocally(); 
                document.getElementById('student-name-input').focus();
                speakMalay(`Selamat Datang ke Kuiz Bijak Sifir! Edukids by Mizz! Sila masukkan nama anda dan pilih jenis kuiz.`);
            } else {
                playIncorrectSound();
                feedback.textContent = 'Kata Laluan Salah. Sila cuba lagi.';
                feedback.classList.remove('text-lime-600');
                feedback.classList.add('text-red-600');
                document.getElementById('password-input').value = '';
                document.getElementById('password-input').focus();
            }
        }

        function handleLoginKey(event) {
            if (event.key === 'Enter') {
                checkPassword();
            }
        }

        function generateDistractors(correctAnswer) {
            const distractors = new Set();
            const maxAttempts = 10;
            let attempts = 0;

            while (distractors.size < 3 && attempts < maxAttempts) {
                attempts++;
                let offset = Math.floor(Math.random() * 11) - 5; 
                let distractor = correctAnswer + offset;
                if (distractor > 0 && distractor !== correctAnswer && !distractors.has(distractor)) {
                    distractors.add(distractor);
                }
            }

            if (distractors.size < 3) {
                [1, -1, 10, correctAnswer % 10 === 0 ? -10 : 0].forEach(offset => {
                    let d = correctAnswer + offset;
                    if (d > 0 && d !== correctAnswer && distractors.size < 3 && !distractors.has(d)) {
                        distractors.add(d);
                    }
                });
            }

            return Array.from(distractors).slice(0, 3);
        }

        function generateQuestions(sifir, mode, count) {
            questions = [];
            for (let i = 0; i < count; i++) {
                let multiplier;
                let factor = Math.floor(Math.random() * 12) + 1;
                
                if (sifir === 0) {
                    multiplier = Math.floor(Math.random() * 12) + 1;
                } else {
                    multiplier = sifir;
                }

                const correctAnswer = multiplier * factor;
                const questionObj = {
                    text: `${multiplier} x ${factor} = ?`,
                    spoken: `${multiplier} darab ${factor}`,
                    correctAnswer: correctAnswer
                };

                if (mode === 'objective') {
                    const distractors = generateDistractors(correctAnswer);
                    const options = [correctAnswer, ...distractors];
                    shuffleArray(options);
                    questionObj.options = options;
                }

                questions.push(questionObj);
            }
        }

        function startQuizFlow() {
            if (!studentName || studentName.trim() === "") {
                alert("Sila masukkan Nama Pelajar terlebih dahulu sebelum memulakan kuiz.");
                document.getElementById('student-name-input').focus();
                return;
            }
            
            initAudio();
            speakMalay("Jom Mula");

            const selectionValue = document.getElementById('sifir-pilihan').value;
            const parts = selectionValue.split('-');
            
            currentSifir = parseInt(parts[0]);
            currentMode = parts[1];
            totalQuestions = parseInt(parts[2]);
            isCombinedQuiz = (currentSifir === 0);

            if (currentMode === 'objective') {
                questionDuration = isTTSEnabled ? 7 : 5; 
            } else {
                questionDuration = isTTSEnabled ? 10 : 7; 
            }

            generateQuestions(currentSifir, currentMode, totalQuestions);
            
            currentQIndex = 0;
            score = 0;
            totalTimeElapsed = 0;
            phraseIndex = 0; 

            document.getElementById('total-q-display').textContent = totalQuestions;
            
            showScreen('quiz-screen');
            
            // FIX: Tambah delay 1000ms (1 saat) supaya ayat "Jom Mula" sempat keluar 
            // sebelum soalan pertama disebut.
            setTimeout(() => {
                loadQuestion();
                startTotalTimer();
            }, 1000);
        }

        function loadQuestion() {
            const q = questions[currentQIndex];
            document.getElementById('current-q-num').textContent = currentQIndex + 1;
            document.getElementById('question-text').textContent = q.text;
            
            const progress = (currentQIndex / totalQuestions) * 100;
            document.getElementById('progress-bar').style.width = `${progress}%`;

            if (currentMode === 'input') {
                document.getElementById('input-mode').classList.remove('hidden');
                document.getElementById('objective-mode').classList.add('hidden');
                document.getElementById('answer-input').value = '';
                document.getElementById('answer-input').focus();
            } else {
                document.getElementById('input-mode').classList.add('hidden');
                document.getElementById('objective-mode').classList.remove('hidden');
                
                const buttons = ['A', 'B', 'C', 'D'];
                buttons.forEach((btn, idx) => {
                    const val = q.options[idx];
                    const buttonEl = document.getElementById(`option-${btn}`);
                    buttonEl.querySelector('span').textContent = val;
                    buttonEl.dataset.value = val;
                });
            }

            document.getElementById('feedback').textContent = '';
            speakMalay(q.spoken);
            startQuestionTimer();
        }

        function startTotalTimer() {
            totalTimeInterval = setInterval(() => {
                totalTimeElapsed += 0.1;
                document.getElementById('total-time-tracker').textContent = totalTimeElapsed.toFixed(1);
            }, 100);
        }

        function startQuestionTimer() {
            clearInterval(qTimerInterval);
            stopWarningBeeps();
            
            const timerDisplay = document.getElementById('q-countdown-display');
            timerDisplay.classList.remove('urgent-timer');
            
            if (!isTimerEnabled) {
                timerDisplay.textContent = "‚àû";
                return;
            }

            qTimeLeft = questionDuration;
            timerDisplay.textContent = `${qTimeLeft}s`;

            qTimerInterval = setInterval(() => {
                qTimeLeft--;
                timerDisplay.textContent = `${qTimeLeft}s`;

                if (qTimeLeft <= 3) {
                    timerDisplay.classList.add('urgent-timer');
                    startWarningBeeps();
                }

                if (qTimeLeft <= 0) {
                    clearInterval(qTimerInterval);
                    stopWarningBeeps();
                    handleTimeout();
                }
            }, 1000);
        }

        function handleTimeout() {
            document.getElementById('feedback').textContent = 'Masa Tamat!';
            document.getElementById('feedback').className = 'h-6 text-sm font-semibold text-red-600';
            playIncorrectSound();
            speakMalay("Masa tamat!");
            
            const gap = isTTSEnabled ? 1500 : 800;
            setTimeout(nextQuestion, gap);
        }

        function handleInputSubmission() {
            const input = document.getElementById('answer-input').value.trim();
            if (input === "") return;
            checkAnswer(parseInt(input));
        }

        function handleObjectiveSubmission(button) {
            const value = parseInt(button.dataset.value);
            checkAnswer(value);
        }

        function checkAnswer(userAnswer) {
            clearInterval(qTimerInterval);
            stopWarningBeeps();

            const correct = questions[currentQIndex].correctAnswer;
            const feedback = document.getElementById('feedback');

            if (userAnswer === correct) {
                score++;
                feedback.textContent = 'Betul! ‚úÖ';
                feedback.className = 'h-6 text-sm font-semibold text-lime-600';
                playCorrectSound();
                
                speakMalay(correctAnswersPhrases[phraseIndex]);
                phraseIndex = (phraseIndex + 1) % correctAnswersPhrases.length; 
                
                const gap = isTTSEnabled ? 2225 : 800;
                setTimeout(nextQuestion, gap); 
            } else {
                feedback.textContent = `Salah! Jawapan: ${correct} ‚ùå`;
                feedback.className = 'h-6 text-sm font-semibold text-red-600';
                playIncorrectSound();
                speakMalay(`Salah! Jawapan adalah ${correct}`);
                
                const gap = isTTSEnabled ? 4000 : 2000;
                setTimeout(nextQuestion, gap); 
            }
        }

        function handleInputKey(event) {
            if (event.key === 'Enter') {
                handleInputSubmission();
            }
        }

        function nextQuestion() {
            currentQIndex++;
            if (currentQIndex < totalQuestions) {
                loadQuestion();
            } else {
                endQuiz();
            }
        }

        function endQuiz() {
            clearInterval(totalTimeInterval);
            showScreen('result-screen');

            const percentage = (score / totalQuestions) * 100;
            const avgTime = (totalTimeElapsed / totalQuestions).toFixed(2);

            document.getElementById('student-result-name').textContent = studentName || 'Pelajar Bijak';

            const sifirTitle = isCombinedQuiz ? "Gabungan (1-12)" : `Sifir ${currentSifir}`;
            document.getElementById('sifir-title-display').textContent = sifirTitle;

            document.getElementById('final-score').textContent = `${score} / ${totalQuestions}`;
            document.getElementById('final-percentage').textContent = `${percentage.toFixed(0)}%`;
            document.getElementById('correct-count').textContent = score;
            document.getElementById('incorrect-count').textContent = totalQuestions - score;
            document.getElementById('average-time').textContent = avgTime;
            
            const timerStatusMsg = document.getElementById('timer-status-message');
            if (isTimerEnabled) {
                 timerStatusMsg.textContent = `(Ujian dijalankan dengan pemasa soalan diaktifkan)`;
            } else {
                 timerStatusMsg.textContent = `(Ujian dijalankan TANPA pemasa soalan)`;
            }

            let tp = 1;
            let label = "";
            let description = "";

            if (percentage >= 90) {
                tp = 6;
                label = "Cemerlang & Role Model";
                description = "Murid berupaya menggunakan pengetahuan dan kemahiran matematik bagi menyelesaikan masalah harian yang bukan rutin secara kreatif dan inovatif serta boleh menjadi pembimbing kepada rakan lain.";
            } else if (percentage >= 80) {
                tp = 5;
                label = "Sangat Baik (Mahir)";
                description = "Murid berupaya menyelesaikan masalah harian yang rutin berkaitan sifir dengan menggunakan pelbagai strategi dan kemahiran.";
            } else if (percentage >= 60) {
                tp = 4;
                label = "Baik (Berupaya)";
                description = "Murid berupaya menyelesaikan masalah harian yang rutin berkaitan sifir secara sistematik dan berkesan.";
            } else if (percentage >= 40) {
                tp = 3;
                label = "Memuaskan (Faham)";
                description = "Murid memahami konsep asas pendaraban dan berupaya menentukan hasil darab bagi sifir yang diuji.";
            } else if (percentage >= 20) {
                tp = 2;
                label = "Kurang Memuaskan";
                description = "Murid mempunyai pengetahuan asas tentang konsep pendaraban namun masih memerlukan masa atau bantuan untuk mengingati sifir.";
            } else {
                tp = 1;
                label = "Tahap Minimum";
                description = "Murid mula menunjukkan minat dalam pembelajaran sifir tetapi memerlukan banyak bimbingan dan latihan asas.";
            }

            document.getElementById('final-tp').textContent = `TP ${tp}`;
            document.getElementById('tp-label').textContent = label;
            document.getElementById('tp-description').textContent = description;

            updateCertificateButton(percentage, tp, avgTime, sifirTitle);

            const closingText = `Kuiz tamat! ${studentName}, anda mencapai Tahap Penguasaan ${tp}. Skor anda adalah ${score} per ${totalQuestions}. Tahniah!`;
            speakMalay(closingText);
        }

        function returnToSelection() {
            speakMalay("kembali ke pilihan sifir");
            clearInterval(qTimerInterval);
            clearInterval(totalTimeInterval);
            stopWarningBeeps();
            showScreen('selection-screen');
        }

        function startNewQuizSelection() {
             showScreen('selection-screen');
        }

        function displayCertificate(percentage, tp, avgTime, quizTitle, timerNote) {
            document.getElementById('cert-student-name').textContent = studentName || '[NAMA PELAJAR]';
            document.getElementById('cert-quiz-title').textContent = `Kuiz Bijak Sifir ${quizTitle}`;
            document.getElementById('cert-tp').textContent = `TP ${tp}`;
            document.getElementById('cert-score').textContent = `${percentage.toFixed(0)}%`;
            document.getElementById('cert-avg-time').textContent = `${avgTime}s`;
            document.getElementById('cert-date').textContent = new Date().toLocaleDateString('ms-MY', { 
                day: 'numeric', month: 'long', year: 'numeric' 
            });
            
            document.getElementById('cert-timer-note').textContent = timerNote;
            document.getElementById('certificate-screen').classList.remove('hidden');
            document.getElementById('certificate-screen').classList.add('flex');
            
            speakMalay("Sijil anda telah dijana. Sila klik butang cetak untuk menyimpan sebagai P D F.");
        }

        function closeCertificate() {
            document.getElementById('certificate-screen').classList.add('hidden');
            document.getElementById('certificate-screen').classList.remove('flex');
        }

        function updateCertificateButton(finalPercentage, finalTP, avgTime, certQuizTitle) {
            const resultScreen = document.getElementById('result-screen');
            const certButtonId = 'print-cert-button';
            let certButton = document.getElementById(certButtonId);

            const isTotalTimeout = (score === 0 && totalTimeElapsed > (totalQuestions * 5));
            
            let timerNoteForCert = "";
            if (isTimerEnabled) {
                timerNoteForCert = "‚úì Ujian ini diselesaikan dengan cabaran pemasa soalan.";
            } else {
                timerNoteForCert = "‚ö† Ujian ini diselesaikan tanpa menggunakan pemasa soalan.";
            }

            if (resultScreen && !isTotalTimeout && finalTP > 0) { 
                if (!certButton) {
                    certButton = document.createElement('button');
                    certButton.id = certButtonId;
                    certButton.className = 'w-full bg-lime-500 hover:bg-lime-600 text-white font-black text-base py-3 rounded-lg transition duration-150 shadow-lg hover:shadow-xl mt-3';
                    const repeatButton = document.querySelector('#result-screen button:last-child');
                    document.getElementById('result-screen').insertBefore(certButton, repeatButton);
                }
                certButton.textContent = 'üèÖ Cetak Sijil Penghargaan';
                certButton.onclick = () => displayCertificate(finalPercentage, finalTP, avgTime, certQuizTitle, timerNoteForCert); 
                certButton.classList.remove('hidden');
            } else if (certButton) {
                 certButton.classList.add('hidden');
            }
        }
    </script>
</body>
</html>
